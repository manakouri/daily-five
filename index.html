<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Five</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F9F9F7;
        }
        /* Custom style to ensure SVGs scale correctly within their containers */
        .question-box svg {
            width: 100%;
            height: auto;
            max-height: 200px; /* Prevents SVGs from becoming too large */
        }
    </style>
</head>
<body class="antialiased text-gray-800">

    <div id="app-container" class="min-h-screen flex flex-col items-center justify-center p-4 sm:p-6 lg:p-8">
        
        <!-- Main content area -->
        <main id="main-content" class="w-full max-w-7xl mx-auto">
            <header class="text-center mb-6">
                <h1 class="text-3xl sm:text-4xl font-bold text-gray-900 tracking-tight">Daily Five</h1>
                <p class="mt-2 text-base text-gray-600">A new set of daily math questions.</p>
            </header>

            <!-- Questions Grid -->
            <div id="questions-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6">
                <!-- Question boxes will be inserted here by JavaScript -->
            </div>
            
            <!-- Action Buttons -->
            <div class="mt-8 flex flex-col sm:flex-row items-center justify-center gap-4">
                <button id="generate-btn" class="w-full sm:w-auto bg-blue-600 text-white font-semibold py-3 px-8 rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-transform transform hover:scale-105">
                    Generate New Set
                </button>
                <button id="answers-btn" class="w-full sm:w-auto bg-gray-200 text-gray-800 font-semibold py-3 px-8 rounded-lg hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-400 transition-transform transform hover:scale-105">
                    Show Answers
                </button>
            </div>

            <!-- Answers Section (Initially Hidden) -->
            <div id="answers-container" class="hidden mt-8 max-w-3xl mx-auto bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-bold text-center mb-4">Answers</h2>
                <ol id="answers-list" class="list-decimal list-inside space-y-2 text-lg">
                    <!-- Answers will be inserted here -->
                </ol>
            </div>

        </main>
    </div>

    <script>
        // --- DOM Elements ---
        const questionsGrid = document.getElementById('questions-grid');
        const generateBtn = document.getElementById('generate-btn');
        const answersBtn = document.getElementById('answers-btn');
        const answersContainer = document.getElementById('answers-container');
        const answersList = document.getElementById('answers-list');

        let currentAnswers = [];

        // --- Utility Functions ---
        function getRandomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // --- Question Generation Functions ---
        const questionGenerators = {
            numberKnowledge: [
                () => {
                    const num = getRandomInt(10000, 99999);
                    const places = [1, 10, 100, 1000, 10000];
                    const placeIndex = getRandomInt(0, 4);
                    const placeValue = places[placeIndex];
                    const digit = Math.floor(num / placeValue) % 10;
                    const placeName = {1: 'ones', 10: 'tens', 100: 'hundreds', 1000: 'thousands', 10000: 'ten thousands'}[placeValue];
                    
                    return {
                        question: `In the number <strong>${num.toLocaleString()}</strong>, what is the value of the digit in the ${placeName} place?`,
                        answer: (digit * placeValue).toLocaleString()
                    };
                },
                () => {
                    const denominator = [4, 6, 8][getRandomInt(0, 2)];
                    const numerator = getRandomInt(1, denominator - 2);
                    return {
                        question: `What is <strong><sup>${numerator}</sup>&frasl;<sub>${denominator}</sub> + <sup>1</sup>&frasl;<sub>${denominator}</sub></strong>?`,
                        answer: `<sup>${numerator + 1}</sup>&frasl;<sub>${denominator}</sub>`
                    }
                },
                 () => {
                    const scenarios = [
                        { item: 'cake', pieces: 8, question: 'A cake was cut into quarters and then each quarter was cut in half.'},
                        { item: 'pizza', pieces: 8, question: 'A pizza was cut into quarters and then each quarter was cut in half.'},
                        { item: 'cake', pieces: 6, question: 'A cake was cut in half and then each half was cut into thirds.'},
                        { item: 'pizza', pieces: 6, question: 'A pizza was cut in half and then each half was cut into thirds.'},
                    ];
                    const scenario = scenarios[getRandomInt(0, scenarios.length - 1)];
                    return {
                        question: `${scenario.question} How many pieces were there?`,
                        answer: `${scenario.pieces} pieces`
                    }
                },
                () => {
                    const num = getRandomInt(2000, 5000);
                    return {
                        question: `What number is 100 more than <strong>${num.toLocaleString()}</strong>?`,
                        answer: (num + 100).toLocaleString()
                    }
                },
                () => {
                    const tens = getRandomInt(15, 45);
                    return {
                        question: `How many $10 notes are in <strong>$${tens * 10}</strong>?`,
                        answer: `${tens}`
                    }
                },
            ],
            algebra: [
                () => {
                    const start = getRandomInt(1, 10);
                    const step = getRandomInt(2, 9);
                    const sequence = [start, start + step, start + step * 2].join(', ');
                    const nextNum = start + step * 3;
                    return {
                        question: `Continue the number pattern: <strong>${sequence}, ...</strong> What is the next number?`,
                        answer: nextNum
                    };
                },
                 () => {
                    const num1 = getRandomInt(2, 10);
                    const num2 = getRandomInt(2, 10);
                    const num3 = getRandomInt(2, 10);
                    const answer = num3 + num2 - num1;
                    return {
                        question: `Find the value of the square: <strong>${num1} + &#9633; = ${num3} + ${num2}</strong>`,
                        answer: answer
                    }
                },
                () => {
                    const scenarios = [
                        () => { // Commutative property of addition
                            const a = getRandomInt(2, 9);
                            const b = getRandomInt(10, 25);
                            const sum = a + b;
                            return {
                                question: `If <strong>${a} + ${b} = ${sum}</strong>, then which symbol goes in the box? <br><strong>${sum} = ${b} [ &#9633; ] ${a}</strong> <br>(+, -, &times;, &div;)`,
                                answer: '+'
                            };
                        },
                        () => { // Inverse of addition (subtraction)
                            const a = getRandomInt(2, 9);
                            const b = getRandomInt(10, 25);
                            const sum = a + b;
                             return {
                                question: `If <strong>${a} + ${b} = ${sum}</strong>, then which symbol goes in the box? <br><strong>${a} = ${sum} [ &#9633; ] ${b}</strong> <br>(+, -, &times;, &div;)`,
                                answer: '-'
                            };
                        },
                        () => { // Inverse of multiplication (division)
                             const a = getRandomInt(2, 9);
                             const b = getRandomInt(2, 9);
                             const product = a * b;
                             return {
                                question: `If <strong>${a} &times; ${b} = ${product}</strong>, then which symbol goes in the box? <br><strong>${b} = ${product} [ &#9633; ] ${a}</strong> <br>(+, -, &times;, &div;)`,
                                answer: '&div;'
                            };
                        }
                    ];
                    return scenarios[getRandomInt(0, scenarios.length - 1)]();
                },
                () => {
                    const unknown = getRandomInt(2, 6);
                    const num1 = unknown * getRandomInt(1, 4);
                    const num2 = unknown * getRandomInt(5, 10);
                    return {
                        question: `If <strong>${num1} &div; &#9633; = ${num1/unknown}</strong>, then what is <strong>${num2} &div; &#9633;</strong>?`,
                        answer: num2 / unknown
                    }
                },
                () => {
                    const addend1 = getRandomInt(20, 50);
                    const sum = getRandomInt(addend1 + 10, 99);
                    return {
                        question: `Find the missing number: <strong>${addend1} + &#9633; = ${sum}</strong>`,
                        answer: sum - addend1
                    }
                },
                () => {
                    const start = getRandomInt(1, 10);
                    const step = getRandomInt(2, 6);
                    const sequence = [start, start + step, '&#9633;', start + step * 3, start + step * 4];
                    return {
                        question: `Find the missing number in the pattern: <strong>${sequence.join(', ')}</strong>`,
                        answer: start + step * 2
                    };
                }
            ],
            statistics: [
                () => {
                    const scenarios = [
                        { title: 'favourite pet', items: ['Cats', 'Dogs', 'Fish'] },
                        { title: 'favourite school subject', items: ['Math', 'Art', 'P.E.'] },
                        { title: 'favourite season', items: ['Summer', 'Winter', 'Autumn'] },
                    ];
                    const scenario = scenarios[getRandomInt(0, scenarios.length - 1)];

                    const total = [40, 50, 60, 80, 100][getRandomInt(0, 4)];
                    const percentCombinations = [
                        [10, 20, 70], [10, 30, 60], [10, 40, 50],
                        [20, 20, 60], [20, 30, 50], [20, 40, 40],
                        [30, 30, 40]
                    ];

                    const chosenPercents = shuffleArray(percentCombinations[getRandomInt(0, percentCombinations.length - 1)]);

                    const data = [
                        { label: scenario.items[0], percent: chosenPercents[0], color: '#60a5fa' },
                        { label: scenario.items[1], percent: chosenPercents[1], color: '#4ade80' },
                        { label: scenario.items[2], percent: chosenPercents[2], color: '#fb923c' }
                    ];

                    data.forEach(item => { item.count = (item.percent / 100) * total; });
                    const targetItem = data[getRandomInt(0, data.length - 1)];
                    const cx = 160; const cy = 60; const r = 50;
                    let startAngle = -90;

                    const paths = data.map(item => {
                        const angle = (item.percent / 100) * 360;
                        const endAngle = startAngle + angle;
                        const x1 = cx + r * Math.cos(startAngle * Math.PI / 180);
                        const y1 = cy + r * Math.sin(startAngle * Math.PI / 180);
                        const x2 = cx + r * Math.cos(endAngle * Math.PI / 180);
                        const y2 = cy + r * Math.sin(endAngle * Math.PI / 180);
                        const largeArcFlag = angle > 180 ? 1 : 0;
                        const d = `M ${cx},${cy} L ${x1},${y1} A ${r},${r} 0 ${largeArcFlag} 1 ${x2},${y2} Z`;
                        startAngle = endAngle;
                        return `<path d="${d}" fill="${item.color}" stroke="white" stroke-width="1.5"></path>`;
                    }).join('');
                    
                    const legend = data.map((item, i) => 
                        `<rect x="10" y="${25 + i * 20}" width="10" height="10" fill="${item.color}"></rect>
                         <text x="25" y="${34 + i * 20}" font-size="11" fill="black">${item.label}: ${item.percent}%</text>`
                    ).join('');

                    const svg = `<svg viewBox="0 0 220 120" class="mx-auto mt-4">${paths}${legend}</svg>`;
                    
                    return {
                        question: `A survey of <strong>${total}</strong> students asked for their ${scenario.title}. Based on the chart, how many students chose ${targetItem.label}?`,
                        svg: svg,
                        answer: targetItem.count
                    };
                },
                () => {
                    const scenarios = [
                        { title: 'sports', items: ['Soccer', 'Rugby', 'Tennis', 'Cricket'] },
                        { title: 'fruits', items: ['Apple', 'Banana', 'Orange', 'Pear'] },
                        { title: 'ice cream flavours', items: ['Mint', 'Vanilla', 'Berry', 'Choc'] },
                    ];
                    const scenario = scenarios[getRandomInt(0, scenarios.length - 1)];
                    
                    const data = [
                        { label: scenario.items[0], count: getRandomInt(5, 20) },
                        { label: scenario.items[1], count: getRandomInt(5, 20) },
                        { label: scenario.items[2], count: getRandomInt(5, 20) },
                        { label: scenario.items[3], count: getRandomInt(5, 20) },
                    ];
                    
                    data.sort((a,b) => a.count - b.count);
                    if (data[0].count === data[1].count) data[0].count = Math.max(1, data[0].count - 1);
                    if (data[3].count === data[2].count) data[3].count += 1;
                    data.sort((a,b) => a.count - b.count);

                    const maxVal = data[3].count;
                    const mostPopular = data[3].label;
                    const leastPopular = data[0].label;
                    const totalStudents = data.reduce((sum, d) => sum + d.count, 0);

                    const questionTypes = [
                        { question: `How many students were surveyed in total?`, answer: totalStudents },
                        { question: `Which ${scenario.title.slice(0,-1)} was the most popular?`, answer: mostPopular },
                        { question: `Which ${scenario.title.slice(0,-1)} was the least popular?`, answer: leastPopular }
                    ];
                    
                    const chosenQuestion = questionTypes[getRandomInt(0, questionTypes.length - 1)];

                    const bars = data.map((item, i) => {
                        const barHeight = (item.count / maxVal) * 80;
                        return `<g transform="translate(${20 + i * 45}, 0)">
                                    <rect y="${100 - barHeight}" width="30" height="${barHeight}" fill="#60a5fa"></rect>
                                    <text x="15" y="115" text-anchor="middle" font-size="10">${item.label}</text>
                                    <text x="15" y="${95 - barHeight}" text-anchor="middle" font-size="10" fill="black">${item.count}</text>
                                </g>`;
                    }).join('');
                    const svg = `<svg viewBox="0 0 200 120" class="mx-auto mt-4">${bars}</svg>`;
                    
                    return {
                        question: `The bar chart shows the favourite ${scenario.title} of a group of students. ${chosenQuestion.question}`,
                        svg: svg,
                        answer: chosenQuestion.answer
                    };
                },
                 () => {
                    const scenarios = [
                        { subject: 'players', item: 'goals', verb: 'scored' },
                        { subject: 'students', item: 'books', verb: 'read' }
                    ];
                    const scenario = scenarios[getRandomInt(0, scenarios.length - 1)];

                    const data = [
                        {name: 'Sam', count: getRandomInt(3, 8)}, {name: 'Jen', count: getRandomInt(3, 8)},
                        {name: 'Mo', count: getRandomInt(3, 8)}, {name: 'Li', count: getRandomInt(3, 8)},
                    ].sort((a,b) => a.count - b.count);

                    const threshold = data[getRandomInt(1,2)].count;
                    
                    const questionType = getRandomInt(0, 1); // 0 for fewer, 1 for more
                    let questionText, answerCount;

                    if (questionType === 0) {
                        questionText = `fewer than <strong>${threshold} ${scenario.item}</strong>`;
                        answerCount = data.filter(p => p.count < threshold).length;
                    } else {
                        questionText = `more than <strong>${threshold} ${scenario.item}</strong>`;
                        answerCount = data.filter(p => p.count > threshold).length;
                    }

                    let table = `<table class="w-full text-center mt-4 border-collapse"><thead><tr><th class="border p-2">${scenario.subject.slice(0,-1)}</th><th class="border p-2">${scenario.item}</th></tr></thead><tbody>`;
                    data.forEach(p => { table += `<tr><td class="border p-2">${p.name}</td><td class="border p-2">${p.count}</td></tr>`; });
                    table += `</tbody></table>`;
                    
                    return {
                        question: `Using the frequency table, how many ${scenario.subject} ${scenario.verb} ${questionText}? ${table}`,
                        answer: answerCount
                    };
                }
            ],
            numberStrategies: [
                () => {
                    const scenarios = [
                        {
                            setup: (count) => `One whetū (star) is made from ${count} strips of harakeke (flax).`,
                            query: (total) => `How many whetū will <strong>${total}</strong> strips of harakeke make?`,
                            answerUnit: 'whetū'
                        },
                        {
                            setup: (count) => `One bag can hold ${count} jellybeans.`,
                            query: (total) => `How many bags will <strong>${total}</strong> jellybeans fill?`,
                            answerUnit: 'bags'
                        },
                        {
                            setup: (count) => `One shelf can hold ${count} boxes of Weet-Bix.`,
                            query: (total) => `How many shelves will <strong>${total}</strong> boxes of Weet-Bix fill?`,
                            answerUnit: 'shelves'
                        }
                    ];
                    
                    const scenario = scenarios[getRandomInt(0, scenarios.length - 1)];
                    const itemsPerUnit = getRandomInt(2, 9);
                    const totalItems = itemsPerUnit * getRandomInt(5, 15);

                    return {
                        question: `${scenario.setup(itemsPerUnit)} ${scenario.query(totalItems)}`,
                        answer: `${totalItems / itemsPerUnit} ${scenario.answerUnit}`
                    };
                },
                 () => {
                    const coveredRows = getRandomInt(3, 8);
                    const coveredCols = getRandomInt(3, 8);
                    const coveredCount = coveredRows * coveredCols;
                    const spacing = 12;
                    
                    let beads = '';
                    for (let r = 0; r < 10; r++) {
                        for (let c = 0; c < 10; c++) {
                            const isCovered = r < coveredRows && c < coveredCols;
                            beads += `<circle cx="${10 + c * spacing}" cy="${10 + r * spacing}" r="4" fill="${isCovered ? '#a1a1aa' : 'black'}" />`;
                        }
                    }
                    const cover = `<rect x="4" y="4" width="${coveredCols * spacing}" height="${coveredRows * spacing}" fill="#d4d4d8" stroke="#71717a" stroke-width="1" />`;
                    const svg = `<svg viewBox="0 0 ${10*spacing + 10} ${10*spacing + 10}" class="mx-auto mt-4">${beads}${cover}</svg>`;

                    return {
                        question: `There are 100 beads on the frame. How many have been covered up?`,
                        svg: svg,
                        answer: `${coveredCount} beads`
                    }
                },
                 () => {
                    const scenarios = [
                        { item1: 'ice cream', item2: 'chocolate bar', plural1: 'ice creams', plural2: 'chocolate bars'},
                        { item1: 'notebook', item2: 'pen', plural1: 'notebooks', plural2: 'pens'},
                        { item1: 'apple', item2: 'banana', plural1: 'apples', plural2: 'bananas'},
                    ];
                    const scenario = scenarios[getRandomInt(0, scenarios.length - 1)];
                    let num1, num2;
                    do {
                        num1 = getRandomInt(2, 5);
                        num2 = getRandomInt(2, 5);
                    } while (num1 === num2);

                    const isMoreExpensive = num1 < num2;
                    const comparison = getRandomInt(0,1) === 0 ? 'less than' : 'more than';
                    let correctAnswer;
                    
                    if(comparison === 'less than'){
                        correctAnswer = !isMoreExpensive;
                    } else { // more than
                        correctAnswer = isMoreExpensive;
                    }

                    return {
                        question: `True or False: If ${num1} ${scenario.plural1} are the same price as ${num2} ${scenario.plural2}, then one ${scenario.item1} costs <strong>${comparison}</strong> one ${scenario.item2}.`,
                        answer: correctAnswer ? 'True' : 'False'
                    };
                },
                () => {
                     const scenarios = [
                        { subject: 'Jamal', verb: 'making a necklace', item1: 'spotty beads', item2: 'stripey beads'},
                        { subject: 'Sofia', verb: 'building a Lego tower', item1: 'square blocks', item2: 'rectangle blocks'},
                        { subject: 'Amira', verb: 'making fruit kebabs', item1: 'strawberries', item2: 'pieces of banana'},
                    ];
                    const scenario = scenarios[getRandomInt(0, scenarios.length - 1)];

                    const ratio1 = getRandomInt(2, 4);
                    let ratio2;
                    do {
                        ratio2 = getRandomInt(3, 7);
                    } while (ratio1 === ratio2);
                    
                    const multiplier = getRandomInt(3, 7);
                    const num1 = ratio1 * multiplier;
                    const num2 = ratio2 * multiplier;
                    return {
                        question: `${scenario.subject} is ${scenario.verb}. They use ${ratio1} ${scenario.item1} for every ${ratio2} ${scenario.item2}. If they use <strong>${num1} ${scenario.item1}</strong>, how many ${scenario.item2} will they need?`,
                        answer: `${num2} ${scenario.item2}`
                    }
                },
                () => {
                    const num1 = getRandomInt(800, 950);
                    const num2 = getRandomInt(600, 790);
                    const num3 = getRandomInt(100, 250);
                    return {
                        question: `What is <strong>${num1} + ${num2} + ${num3}</strong>?`,
                        answer: (num1 + num2 + num3).toLocaleString()
                    }
                },
                () => {
                    const num1 = getRandomInt(25, 49);
                    const num2 = getRandomInt(25, 49);
                    const num3 = getRandomInt(25, 49);
                    return {
                        question: `A farmer collected ${num1} eggs on Monday, ${num2} on Tuesday, and ${num3} on Wednesday. How many eggs were collected in total?`,
                        answer: num1 + num2 + num3
                    }
                }
            ],
            geometryMeasurement: [
                () => {
                    const hour = getRandomInt(1, 12);
                    const minute = getRandomInt(0, 11) * 5;
                    const hourAngle = (hour % 12 + minute / 60) * 30;
                    const minuteAngle = minute * 6;
                    
                    let markers = '';
                    for (let i = 1; i <= 12; i++) {
                        const angle = i * 30 * Math.PI / 180;
                        const x = 50 + 40 * Math.sin(angle);
                        const y = 50 - 40 * Math.cos(angle);
                        markers += `<text x="${x}" y="${y+3}" text-anchor="middle" font-size="8">${i}</text>`;
                    }

                    const svg = `<svg viewBox="0 0 100 100" class="mx-auto mt-4">
                                    <circle cx="50" cy="50" r="45" stroke="black" fill="white" />
                                    ${markers}
                                    <line x1="50" y1="50" x2="${50 + 25 * Math.sin(hourAngle * Math.PI / 180)}" y2="${50 - 25 * Math.cos(hourAngle * Math.PI / 180)}" stroke="black" stroke-width="3" />
                                    <line x1="50" y1="50" x2="${50 + 35 * Math.sin(minuteAngle * Math.PI / 180)}" y2="${50 - 35 * Math.cos(minuteAngle * Math.PI / 180)}" stroke="black" stroke-width="2" />
                                    <circle cx="50" cy="50" r="3" fill="black" />
                                </svg>`;
                    
                    return {
                        question: `What time is shown on the clock?`,
                        svg: svg,
                        answer: `${hour}:${minute.toString().padStart(2, '0')}`
                    }
                },
                 () => {
                    // Horizontal Ruler
                    const scaleFactor = 20; // Pixels per cm
                    const increments = [0.1, 0.2, 0.5];
                    const increment = increments[getRandomInt(0, increments.length - 1)];
                    const numIncrements = 1 / increment;
                    
                    let length;
                    if (increment === 0.1) length = (getRandomInt(2, 9) + getRandomInt(1, 9) / 10).toFixed(1);
                    else if (increment === 0.2) length = (getRandomInt(2, 9) + getRandomInt(1, 4) * 0.2).toFixed(1);
                    else length = (getRandomInt(2, 9) + 0.5).toFixed(1);
                    
                    let markings = '';
                    for(let i = 0; i <= 10; i++){
                        // Main cm tick and number
                        markings += `<line x1="${10 + i * scaleFactor}" y1="40" x2="${10 + i * scaleFactor}" y2="30" stroke="black" />`;
                        markings += `<text x="${10 + i * scaleFactor}" y="25" text-anchor="middle" font-size="8">${i}</text>`;
                        
                        // Sub-cm ticks
                        if (i < 10) {
                            for(let j = 1; j < numIncrements; j++) {
                                const x = 10 + i * scaleFactor + j * increment * scaleFactor;
                                const tickHeight = (increment === 0.5 && j * increment === 0.5) ? 33 : 35; // Taller for 0.5
                                markings += `<line x1="${x}" y1="40" x2="${x}" y2="${tickHeight}" stroke="black" />`;
                            }
                        }
                    }

                    const svg = `<svg viewBox="0 0 240 60" class="mx-auto mt-4">
                                    <rect x="10" y="45" width="${length * scaleFactor}" height="10" fill="#fca5a5" />
                                    <line x1="10" y1="40" x2="${10 + 10 * scaleFactor}" y2="40" stroke="black" />
                                    ${markings}
                                    <text x="${20 + 10 * scaleFactor}" y="40" font-size="8" dominant-baseline="middle">cm</text>
                                </svg>`;

                    return {
                        question: 'How long is the red bar in centimetres?',
                        svg: svg,
                        answer: `${length} cm`
                    };
                },
                () => {
                    // Vertical Measuring Cup
                    const increments = [1, 2, 5];
                    const increment = increments[getRandomInt(0, increments.length - 1)];
                    const numIncrements = 10 / increment;

                    let ml;
                    if (increment === 1) ml = getRandomInt(51, 99);
                    else if (increment === 2) ml = 50 + getRandomInt(1, 24) * 2;
                    else ml = 50 + getRandomInt(1, 9) * 5;

                    let markings = '';
                    for(let i = 0; i <= 100; i += 10) {
                        markings += `<line x1="45" y1="${120-i}" x2="55" y2="${120-i}" stroke="black" />`;
                        markings += `<text x="38" y="${124-i}" font-size="8" text-anchor="end">${i}</text>`;
                    }
                    
                    for(let i = 0; i < 100; i += 10) {
                         for(let j = 1; j < numIncrements; j++) {
                            const y = 120 - (i + j * increment);
                            const tickWidth = (increment === 5 && j * increment === 5) ? 48 : 50; // Taller for 5ml
                            markings += `<line x1="${tickWidth}" y1="${y}" x2="52" y2="${y}" stroke="black" />`;
                         }
                    }
                    
                    const svg = `<svg viewBox="0 0 100 140" class="mx-auto mt-4">
                                    <rect x="55" y="${120-ml}" width="20" height="${ml}" fill="#67e8f9"/>
                                    <path d="M 50 120 L 50 10 L 80 10 L 80 120" stroke="black" fill="none"/>
                                    ${markings}
                                    <text x="75" y="130" font-size="10">ml</text>
                                </svg>`;
                    return {
                        question: 'How much liquid is in the measuring cup?',
                        svg: svg,
                        answer: `${ml} ml`
                    }
                },
                () => {
                    const width = getRandomInt(5, 8);
                    const height = getRandomInt(3, 5);
                    const units = ['centimetres', 'metres'];
                    const unit = units[getRandomInt(0, 1)];
                    const unitAbbr = unit === 'centimetres' ? 'cm' : 'm';
                    
                    let grid = '';
                    for (let i = 0; i < height; i++) {
                        for (let j = 0; j < width; j++) {
                            grid += `<rect x="${j * 20}" y="${i * 20}" width="20" height="20" stroke="gray" fill="#a7f3d0"/>`;
                        }
                    }
                    const svg = `<svg viewBox="-1 -1 ${width*20+2} ${height*20+2}" class="mx-auto mt-4">${grid}</svg>`;
                    return {
                        question: `Each square in the grid below is 1 square ${unit.slice(0,-1)}. What is the area of the shape?`,
                        svg: svg,
                        answer: `${width * height} ${unitAbbr}²`
                    };
                },
                () => {
                    // This function generates rotation or reflection questions.
                    const size = 20; // Size of each grid square
                    const viewBoxSize = 120;
                    const center = viewBoxSize / 2;
                    const shapePoints = "40,40 40,60 60,60 60,80 80,80 80,40"; // L-shape
                    
                    const drawGrid = () => {
                        let lines = '';
                        for (let i = 0; i <= viewBoxSize; i += size) {
                            lines += `<line x1="${i}" y1="0" x2="${i}" y2="${viewBoxSize}" stroke="#e5e7eb" stroke-width="0.5"/>`;
                            lines += `<line x1="0" y1="${i}" x2="${viewBoxSize}" y2="${i}" stroke="#e5e7eb" stroke-width="0.5"/>`;
                        }
                        return lines;
                    };

                    const type = getRandomInt(0, 1); // 0 for reflection, 1 for rotation

                    if (type === 0) { // Reflection
                        const axis = getRandomInt(0, 1) === 0 ? 'y' : 'x'; // Reflect across y or x
                        const line = `<line x1="${axis === 'y' ? center : 0}" y1="${axis === 'y' ? 0 : center}" x2="${axis === 'y' ? center : viewBoxSize}" y2="${axis === 'y' ? viewBoxSize : center}" stroke="black" stroke-width="1" stroke-dasharray="2 2"/>`;
                        
                        const qSvg = `<svg viewBox="0 0 ${viewBoxSize} ${viewBoxSize}" class="mx-auto mt-4">
                                        ${drawGrid()}
                                        <polygon points="${shapePoints}" fill="#93c5fd" />
                                        ${line}
                                      </svg>`;
                        
                        const transform = axis === 'y' ? `transform="scale(-1, 1) translate(-${viewBoxSize}, 0)"` : `transform="scale(1, -1) translate(0, -${viewBoxSize})"`;
                        const aSvg = `<svg viewBox="0 0 ${viewBoxSize} ${viewBoxSize}" class="mx-auto mt-4">
                                        ${drawGrid()}
                                        <polygon points="${shapePoints}" fill="#d1d5db" />
                                        <polygon points="${shapePoints}" fill="#3b82f6" ${transform} />
                                        ${line}
                                      </svg>`;
                        
                        return {
                            question: `Reflect the shape across the dotted line.`,
                            svg: qSvg,
                            answerSvg: aSvg
                        };

                    } else { // Rotation
                        const angle = [90, 180, 270][getRandomInt(0, 2)];
                        const direction = getRandomInt(0, 1) === 0 ? 'clockwise' : 'anti-clockwise';
                        const rotationAngle = direction === 'clockwise' ? angle : -angle;
                        
                        const qSvg = `<svg viewBox="0 0 ${viewBoxSize} ${viewBoxSize}" class="mx-auto mt-4">
                                        ${drawGrid()}
                                        <polygon points="${shapePoints}" fill="#93c5fd" />
                                        <circle cx="${center}" cy="${center}" r="2" fill="red" />
                                      </svg>`;

                        const aSvg = `<svg viewBox="0 0 ${viewBoxSize} ${viewBoxSize}" class="mx-auto mt-4">
                                        ${drawGrid()}
                                        <polygon points="${shapePoints}" fill="#d1d5db" />
                                        <polygon points="${shapePoints}" fill="#3b82f6" transform="rotate(${rotationAngle}, ${center}, ${center})" />
                                        <circle cx="${center}" cy="${center}" r="2" fill="red" />
                                      </svg>`;

                        return {
                            question: `Rotate the shape <strong>${angle}° ${direction}</strong> around the red dot.`,
                            svg: qSvg,
                            answerSvg: aSvg
                        };
                    }
                }
            ]
        };

        // --- Main App Logic ---
        function generateQuestions() {
            questionsGrid.innerHTML = '';
            answersList.innerHTML = '';
            answersContainer.classList.add('hidden');
            answersBtn.textContent = 'Show Answers';
            currentAnswers = [];
            
            let questions = [];
            for (const category in questionGenerators) {
                const categoryGenerators = questionGenerators[category];
                const generator = categoryGenerators[getRandomInt(0, categoryGenerators.length - 1)];
                questions.push(generator());
            }

            questions = shuffleArray(questions);
            
            questions.forEach((q, index) => {
                const questionBox = document.createElement('div');
                questionBox.className = 'question-box bg-white p-5 rounded-xl shadow-sm border border-gray-200 flex flex-col justify-between';
                
                const questionText = `<p class="text-lg leading-relaxed"><strong class="mr-2">${index + 1}.</strong>${q.question}</p>`;
                const svgContent = q.svg ? q.svg : '';

                questionBox.innerHTML = `
                    <div>
                        ${questionText}
                        <div class="w-full flex justify-center mt-4">
                            ${svgContent}
                        </div>
                    </div>
                `;
                questionsGrid.appendChild(questionBox);
                // Store answer, prioritizing answerSvg if it exists
                currentAnswers.push({ text: q.answer, svg: q.answerSvg });
            });
        }

        function toggleAnswers() {
            const isHidden = answersContainer.classList.toggle('hidden');
            if (isHidden) {
                answersBtn.textContent = 'Show Answers';
            } else {
                answersBtn.textContent = 'Hide Answers';
                answersList.innerHTML = ''; // Clear old answers
                currentAnswers.forEach(answer => {
                    const li = document.createElement('li');
                    if (answer.svg) {
                        li.innerHTML = `<div class="w-full max-w-xs mx-auto">${answer.svg}</div>`;
                    } else {
                        li.innerHTML = answer.text;
                    }
                    answersList.appendChild(li);
                });
            }
        }

        // --- Event Listeners ---
        generateBtn.addEventListener('click', generateQuestions);
        answersBtn.addEventListener('click', toggleAnswers);

        // --- Initial Load ---
        document.addEventListener('DOMContentLoaded', generateQuestions);

    </script>

</body>
</html>

